// components/monitors/MonitorForm.tsx

'use client';
import { useState } from 'react';
import {
  Box,
  TextField,
  Button,
  Grid,
  MenuItem,
  FormControl,
  InputLabel,
  Select,
  FormHelperText,
  Chip,
  InputAdornment,
  Card,
  CardContent,
  Typography,
  Divider,
  Alert,
  Stack,
  IconButton,
  SelectChangeEvent
} from '@mui/material';
import {
  Add as AddIcon,
  Delete as DeleteIcon,
  Save as SaveIcon,
  Cancel as CancelIcon
} from '@mui/icons-material';
import { Monitor } from '@/lib/models/Monitor';
import { useRouter } from 'next/navigation';

interface MonitorFormProps {
  initialData?: Partial<Monitor>;
  mode: 'create' | 'edit';
  monitorId?: string;
}

export default function MonitorForm({ initialData, mode, monitorId }: MonitorFormProps) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  const [formData, setFormData] = useState<Partial<Monitor>>({
    monitor_name: initialData?.monitor_name || '',
    monitor_type: initialData?.monitor_type || 'url',
    created_by: initialData?.created_by || '',
    business_owner: initialData?.business_owner || '',
    alarming_candidate: initialData?.alarming_candidate || [],
    dependencies: initialData?.dependencies || [],
    description: initialData?.description || '',
    severity: initialData?.severity || 'medium',
    monitor_instance: initialData?.monitor_instance || '',
    positive_pattern: initialData?.positive_pattern || '',
    negative_pattern: initialData?.negative_pattern || '',
    low_value_threshold_warning: initialData?.low_value_threshold_warning,
    high_value_threshold_warning: initialData?.high_value_threshold_warning,
    low_value_threshold_alarm: initialData?.low_value_threshold_alarm,
    high_value_threshold_alarm: initialData?.high_value_threshold_alarm,
    consecutive_warning: initialData?.consecutive_warning || 2,
    consecutive_alarm: initialData?.consecutive_alarm || 3,
    status_code: initialData?.status_code || [200, 201, 204, 301, 302, 303, 304],
    period_in_minute: initialData?.period_in_minute || 5,
    timeout_in_second: initialData?.timeout_in_second || 30,
    recovery_action: initialData?.recovery_action || '',
    alarm_after_n_failure: initialData?.alarm_after_n_failure || 3,
    reset_after_m_ok: initialData?.reset_after_m_ok || 2,
    active_disable: initialData?.active_disable ?? true,
    running_stopped: initialData?.running_stopped ?? true,
  });

  const [alarmingInput, setAlarmingInput] = useState('');
  const [dependencyInput, setDependencyInput] = useState('');
  const [statusCodeInput, setStatusCodeInput] = useState('');

  const handleChange = (field: keyof Monitor) => (
    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement> | SelectChangeEvent
  ) => {
    setFormData(prev => ({ ...prev, [field]: event.target.value }));
  };

  const handleNumberChange = (field: keyof Monitor) => (
    event: React.ChangeEvent<HTMLInputElement>
  ) => {
    const value = event.target.value ? parseFloat(event.target.value) : undefined;
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  const handleAddAlarmingCandidate = () => {
    if (alarmingInput.trim()) {
      setFormData(prev => ({
        ...prev,
        alarming_candidate: [...(prev.alarming_candidate || []), alarmingInput.trim()]
      }));
      setAlarmingInput('');
    }
  };

  const handleAddDependency = () => {
    if (dependencyInput.trim()) {
      setFormData(prev => ({
        ...prev,
        dependencies: [...(prev.dependencies || []), dependencyInput.trim()]
      }));
      setDependencyInput('');
    }
  };

  const handleAddStatusCode = () => {
    const code = parseInt(statusCodeInput);
    if (code && code >= 100 && code < 600) {
      setFormData(prev => ({
        ...prev,
        status_code: [...(prev.status_code || []), code]
      }));
      setStatusCodeInput('');
    }
  };

  const handleRemoveStatusCode = (index: number) => {
    setFormData(prev => ({
      ...prev,
      status_code: prev.status_code?.filter((_, i) => i !== index)
    }));
  };

  const validateForm = (): boolean => {
    if (!formData.monitor_name?.trim()) {
      setError('Monitor name is required');
      return false;
    }
    if (!formData.created_by?.trim()) {
      setError('Created by is required');
      return false;
    }
    if (!formData.business_owner?.trim()) {
      setError('Business owner is required');
      return false;
    }
    
    // Validate based on monitor type
    if (formData.monitor_type === 'ssh') {
      const ssh = (formData as any).ssh_config;
      if (!ssh?.host) {
        setError('SSH host is required');
        return false;
      }
      if (!ssh?.username) {
        setError('SSH username is required');
        return false;
      }
      if (!ssh?.password) {
        setError('SSH password is required');
        return false;
      }
      if (!ssh?.command) {
        setError('SSH command is required');
        return false;
      }
    } else {
      if (!formData.monitor_instance?.trim()) {
        setError('Monitor instance is required');
        return false;
      }
    }
    
    // Validate POST body for api_post type
    if (formData.monitor_type === 'api_post') {
      try {
        JSON.parse((formData as any).post_body || '{}');
      } catch (e) {
        setError('Invalid POST body JSON format');
        return false;
      }
    }
    
    return true;
  };

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault();
    setError(null);
    setSuccess(false);

    if (!validateForm()) return;

    setLoading(true);

    try {
      const url = mode === 'create' ? '/api/monitors' : `/api/monitors/${monitorId}`;
      const method = mode === 'create' ? 'POST' : 'PUT';

      const response = await fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData),
      });

      const data = await response.json();

      if (response.ok) {
        setSuccess(true);
        setTimeout(() => router.push('/monitors'), 1500);
      } else {
        setError(data.error || 'Failed to save monitor');
      }
    } catch (err: any) {
      setError(err.message || 'Failed to save monitor');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Box component="form" onSubmit={handleSubmit}>
      {error && <Alert severity="error" sx={{ mb: 3 }} onClose={() => setError(null)}>{error}</Alert>}
      {success && <Alert severity="success" sx={{ mb: 3 }}>Monitor {mode === 'create' ? 'created' : 'updated'} successfully!</Alert>}

      {/* Basic Information */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Basic Information</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                required
                label="Monitor Name"
                value={formData.monitor_name}
                onChange={handleChange('monitor_name')}
                helperText="Unique name for this monitor"
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth required>
                <InputLabel>Monitor Type</InputLabel>
                <Select value={formData.monitor_type} label="Monitor Type" onChange={handleChange('monitor_type')}>
                  <MenuItem value="url">URL / API Endpoint (GET)</MenuItem>
                  <MenuItem value="api_post">API POST Request</MenuItem>
                  <MenuItem value="ssh">SSH Remote Command</MenuItem>
                  <MenuItem value="cpu">CPU Usage</MenuItem>
                  <MenuItem value="memory">Memory Usage</MenuItem>
                  <MenuItem value="disk">Disk Usage</MenuItem>
                  <MenuItem value="system_availability">System Availability</MenuItem>
                  <MenuItem value="custom">Custom</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                required
                label="Created By"
                value={formData.created_by}
                onChange={handleChange('created_by')}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                required
                label="Business Owner"
                value={formData.business_owner}
                onChange={handleChange('business_owner')}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth required>
                <InputLabel>Severity</InputLabel>
                <Select value={formData.severity} label="Severity" onChange={handleChange('severity')}>
                  <MenuItem value="low">Low</MenuItem>
                  <MenuItem value="medium">Medium</MenuItem>
                  <MenuItem value="high">High</MenuItem>
                  <MenuItem value="critical">Critical</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            {formData.monitor_type !== 'ssh' && (
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  required
                  label="Monitor Instance"
                  value={formData.monitor_instance}
                  onChange={handleChange('monitor_instance')}
                  helperText={formData.monitor_type === 'url' || formData.monitor_type === 'api_post' ? 'URL to monitor' : 'System name'}
                />
              </Grid>
            )}
            <Grid item xs={12}>
              <TextField
                fullWidth
                multiline
                rows={3}
                label="Description"
                value={formData.description}
                onChange={handleChange('description')}
              />
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Alarming & Dependencies */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Alarming & Dependencies</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12}>
              <TextField
                fullWidth
                label="Alarming Candidates"
                value={alarmingInput}
                onChange={(e) => setAlarmingInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddAlarmingCandidate())}
                helperText="Email addresses (press Enter)"
                InputProps={{
                  endAdornment: (
                    <InputAdornment position="end">
                      <IconButton onClick={handleAddAlarmingCandidate}><AddIcon /></IconButton>
                    </InputAdornment>
                  ),
                }}
              />
              <Box sx={{ mt: 1, display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                {formData.alarming_candidate?.map((c, i) => (
                  <Chip
                    key={i}
                    label={c}
                    onDelete={() => setFormData(p => ({ ...p, alarming_candidate: p.alarming_candidate?.filter((_, idx) => idx !== i) }))}
                    color="primary"
                    variant="outlined"
                  />
                ))}
              </Box>
            </Grid>
            <Grid item xs={12}>
              <TextField
                fullWidth
                label="Dependencies"
                value={dependencyInput}
                onChange={(e) => setDependencyInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddDependency())}
                InputProps={{
                  endAdornment: (
                    <InputAdornment position="end">
                      <IconButton onClick={handleAddDependency}><AddIcon /></IconButton>
                    </InputAdornment>
                  ),
                }}
              />
              <Box sx={{ mt: 1, display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                {formData.dependencies?.map((d, i) => (
                  <Chip
                    key={i}
                    label={d}
                    onDelete={() => setFormData(p => ({ ...p, dependencies: p.dependencies?.filter((_, idx) => idx !== i) }))}
                    color="secondary"
                    variant="outlined"
                  />
                ))}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* URL Settings */}
      {formData.monitor_type === 'url' && (
        <Card sx={{ mb: 3 }}>
          <CardContent>
            <Typography variant="h6" gutterBottom>URL Monitoring Settings</Typography>
            <Divider sx={{ mb: 3 }} />
            <Grid container spacing={3}>
              <Grid item xs={12}>
                <TextField
                  fullWidth
                  label="Status Codes"
                  value={statusCodeInput}
                  onChange={(e) => setStatusCodeInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddStatusCode())}
                  type="number"
                  InputProps={{
                    endAdornment: (
                      <InputAdornment position="end">
                        <IconButton onClick={handleAddStatusCode}><AddIcon /></IconButton>
                      </InputAdornment>
                    ),
                  }}
                />
                <Box sx={{ mt: 1, display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                  {formData.status_code?.map((c, i) => (
                    <Chip key={i} label={c} onDelete={() => handleRemoveStatusCode(i)} color="success" />
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Positive Pattern"
                  value={formData.positive_pattern}
                  onChange={handleChange('positive_pattern')}
                  helperText="Regex that SHOULD appear"
                />
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Negative Pattern"
                  value={formData.negative_pattern}
                  onChange={handleChange('negative_pattern')}
                  helperText="Regex that SHOULD NOT appear"
                />
              </Grid>
            </Grid>
          </CardContent>
        </Card>
      )}

      {/* API POST Settings */}
      {formData.monitor_type === 'api_post' && (
        <Card sx={{ mb: 3 }}>
          <CardContent>
            <Typography variant="h6" gutterBottom>API POST Settings</Typography>
            <Divider sx={{ mb: 3 }} />
            <Grid container spacing={3}>
              <Grid item xs={12}>
                <TextField
                  fullWidth
                  multiline
                  rows={6}
                  label="POST Body (JSON)"
                  value={(formData as any).post_body || ''}
                  onChange={(e) => setFormData(prev => ({ ...prev, post_body: e.target.value }))}
                  helperText="JSON body to send with POST request"
                  placeholder='{"username": "test", "password": "test123"}'
                />
              </Grid>
              <Grid item xs={12}>
                <TextField
                  fullWidth
                  label="Expected Status Codes"
                  value={statusCodeInput}
                  onChange={(e) => setStatusCodeInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddStatusCode())}
                  type="number"
                  helperText="HTTP status codes (200, 201, etc.)"
                  InputProps={{
                    endAdornment: (
                      <InputAdornment position="end">
                        <IconButton onClick={handleAddStatusCode}><AddIcon /></IconButton>
                      </InputAdornment>
                    ),
                  }}
                />
                <Box sx={{ mt: 1, display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                  {formData.status_code?.map((code, index) => (
                    <Chip
                      key={index}
                      label={code}
                      onDelete={() => handleRemoveStatusCode(index)}
                      color="success"
                    />
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Positive Pattern"
                  value={formData.positive_pattern}
                  onChange={handleChange('positive_pattern')}
                  helperText="Regex that SHOULD appear in response"
                  placeholder='e.g., "success":true or token'
                />
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Negative Pattern"
                  value={formData.negative_pattern}
                  onChange={handleChange('negative_pattern')}
                  helperText="Regex that SHOULD NOT appear"
                  placeholder='e.g., error|exception|failed'
                />
              </Grid>
            </Grid>
          </CardContent>
        </Card>
      )}

      {/* SSH Settings */}
  {formData.monitor_type === 'ssh' && (
  <Card sx={{ mb: 3 }}>
    <CardContent>
      <Typography variant="h6" gutterBottom>SSH Configuration</Typography>
      <Divider sx={{ mb: 3 }} />
      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <TextField
            fullWidth
            required
            label="Host / IP Address"
            value={(formData as any).ssh_config?.host || ''}
            onChange={(e) => {
              const host = e.target.value;
              setFormData(prev => ({
                ...prev,
                monitor_instance: host, // Auto-set monitor_instance
                ssh_config: { ...(prev as any).ssh_config, host }
              }));
            }}
            helperText="e.g., 192.168.1.100 or server.example.com"
          />
        </Grid>
        {/* ... rest of SSH fields ... */}
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  type="number"
                  label="Port"
                  value={(formData as any).ssh_config?.port || 22}
                  onChange={(e) => setFormData(prev => ({
                    ...prev,
                    ssh_config: { ...(prev as any).ssh_config, port: parseInt(e.target.value) }
                  }))}
                  helperText="Default: 22"
                />
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  required
                  label="Username"
                  value={(formData as any).ssh_config?.username || ''}
                  onChange={(e) => setFormData(prev => ({
                    ...prev,
                    ssh_config: { ...(prev as any).ssh_config, username: e.target.value }
                  }))}
                />
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  required
                  type="password"
                  label="Password"
                  value={(formData as any).ssh_config?.password || ''}
                  onChange={(e) => setFormData(prev => ({
                    ...prev,
                    ssh_config: { ...(prev as any).ssh_config, password: e.target.value }
                  }))}
                  helperText="SSH password"
                />
              </Grid>
              <Grid item xs={12}>
                <TextField
                  fullWidth
                  required
                  label="Command or Script Path"
                  value={(formData as any).ssh_config?.command || ''}
                  onChange={(e) => setFormData(prev => ({
                    ...prev,
                    ssh_config: { ...(prev as any).ssh_config, command: e.target.value }
                  }))}
                  helperText="e.g., /home/user/scripts/check_resources.sh or uptime"
                  placeholder="/opt/scripts/system_check.sh"
                />
              </Grid>
              <Grid item xs={12}>
                <Alert severity="info">
                  <Typography variant="body2" gutterBottom>
                    <strong>Script Output Format:</strong>
                  </Typography>
                  <Typography variant="body2" component="div">
                    Your script should output metrics in one of these formats:
                    <ul style={{ marginTop: 8, marginBottom: 0 }}>
                      <li>CPU: 90%</li>
                      <li>Memory: 85%</li>
                      <li>Disk: 75%</li>
                    </ul>
                    Or: <code>cpu=90 memory=85 disk=75</code>
                  </Typography>
                </Alert>
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Positive Pattern"
                  value={formData.positive_pattern}
                  onChange={handleChange('positive_pattern')}
                  helperText="Regex that SHOULD appear (optional)"
                  placeholder="success|ok|completed"
                />
              </Grid>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  label="Negative Pattern"
                  value={formData.negative_pattern}
                  onChange={handleChange('negative_pattern')}
                  helperText="Regex that SHOULD NOT appear (optional)"
                  placeholder="error|failed|exception"
                />
              </Grid>
            </Grid>
          </CardContent>
        </Card>
      )}

      {/* Thresholds */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Thresholds</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                label="Low Warning"
                value={formData.low_value_threshold_warning || ''}
                onChange={handleNumberChange('low_value_threshold_warning')}
                InputProps={{ 
                  endAdornment: <InputAdornment position="end">
                    {formData.monitor_type === 'url' || formData.monitor_type === 'api_post' ? 'ms' : '%'}
                  </InputAdornment> 
                }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                label="High Warning"
                value={formData.high_value_threshold_warning || ''}
                onChange={handleNumberChange('high_value_threshold_warning')}
                InputProps={{ 
                  endAdornment: <InputAdornment position="end">
                    {formData.monitor_type === 'url' || formData.monitor_type === 'api_post' ? 'ms' : '%'}
                  </InputAdornment> 
                }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                label="Low Alarm"
                value={formData.low_value_threshold_alarm || ''}
                onChange={handleNumberChange('low_value_threshold_alarm')}
                InputProps={{ 
                  endAdornment: <InputAdornment position="end">
                    {formData.monitor_type === 'url' || formData.monitor_type === 'api_post' ? 'ms' : '%'}
                  </InputAdornment> 
                }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                label="High Alarm"
                value={formData.high_value_threshold_alarm || ''}
                onChange={handleNumberChange('high_value_threshold_alarm')}
                InputProps={{ 
                  endAdornment: <InputAdornment position="end">
                    {formData.monitor_type === 'url' || formData.monitor_type === 'api_post' ? 'ms' : '%'}
                  </InputAdornment> 
                }}
              />
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Timing */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Timing & Behavior</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Check Period"
                value={formData.period_in_minute}
                onChange={handleNumberChange('period_in_minute')}
                InputProps={{ endAdornment: <InputAdornment position="end">min</InputAdornment> }}
                inputProps={{ min: 1 }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Timeout"
                value={formData.timeout_in_second}
                onChange={handleNumberChange('timeout_in_second')}
                InputProps={{ endAdornment: <InputAdornment position="end">sec</InputAdornment> }}
                inputProps={{ min: 5 }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Consecutive Warnings"
                value={formData.consecutive_warning}
                onChange={handleNumberChange('consecutive_warning')}
                inputProps={{ min: 1 }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Consecutive Alarms"
                value={formData.consecutive_alarm}
                onChange={handleNumberChange('consecutive_alarm')}
                inputProps={{ min: 1 }}
              />
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Recovery */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Recovery & Notifications</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                label="Recovery Action"
                value={formData.recovery_action}
                onChange={handleChange('recovery_action')}
                helperText="Script or action name"
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Alarm After N Failures"
                value={formData.alarm_after_n_failure}
                onChange={handleNumberChange('alarm_after_n_failure')}
                inputProps={{ min: 1 }}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                type="number"
                required
                label="Reset After M OK"
                value={formData.reset_after_m_ok}
                onChange={handleNumberChange('reset_after_m_ok')}
                inputProps={{ min: 1 }}
              />
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Status */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" gutterBottom>Monitor Status</Typography>
          <Divider sx={{ mb: 3 }} />
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth>
                <InputLabel>Active Status</InputLabel>
                <Select
                  value={formData.active_disable ? 'active' : 'disabled'}
                  label="Active Status"
                  onChange={(e) => setFormData(p => ({ ...p, active_disable: e.target.value === 'active' }))}
                >
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="disabled">Disabled</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth>
                <InputLabel>Running Status</InputLabel>
                <Select
                  value={formData.running_stopped ? 'running' : 'stopped'}
                  label="Running Status"
                  onChange={(e) => setFormData(p => ({ ...p, running_stopped: e.target.value === 'running' }))}
                >
                  <MenuItem value="running">Running</MenuItem>
                  <MenuItem value="stopped">Stopped</MenuItem>
                </Select>
              </FormControl>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      <Stack direction="row" spacing={2} justifyContent="flex-end">
        <Button variant="outlined" startIcon={<CancelIcon />} onClick={() => router.push('/monitors')} disabled={loading}>
          Cancel
        </Button>
        <Button type="submit" variant="contained" startIcon={<SaveIcon />} disabled={loading}>
          {loading ? 'Saving...' : mode === 'create' ? 'Create Monitor' : 'Update Monitor'}
        </Button>
      </Stack>
    </Box>
  );
}